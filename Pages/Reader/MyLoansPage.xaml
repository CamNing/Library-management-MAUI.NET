<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="book.Pages.Reader.MyLoansPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="SÃ¡ch cá»§a tÃ´i">
    <Grid RowDefinitions="Auto,*">
        <Frame Grid.Row="0" 
               Padding="15" 
               BackgroundColor="#FF2196F3"
               HasShadow="True"
               CornerRadius="0">
            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
                <Button Grid.Column="0" 
                        Text="â† Quay láº¡i" 
                        Clicked="OnBackClicked"
                        BackgroundColor="#FF1976D2"
                        TextColor="White"
                        CornerRadius="8"
                        WidthRequest="90"/>
                <Label Grid.Column="1" 
                       Text="ðŸ“– SÃ¡ch cá»§a tÃ´i" 
                       FontSize="22" 
                       FontAttributes="Bold"
                       TextColor="White"
                       VerticalOptions="Center"
                       HorizontalOptions="Center"/>
                <Button Grid.Column="2" 
                        Text="ðŸ”„ LÃ m má»›i" 
                        Clicked="OnRefreshClicked"
                        BackgroundColor="#FF1976D2"
                        TextColor="White"
                        CornerRadius="8"
                        WidthRequest="90"/>
            </Grid>
        </Frame>
        <ActivityIndicator x:Name="LoadingIndicator" 
                          Grid.Row="1"
                          IsRunning="False" 
                          IsVisible="False" 
                          VerticalOptions="Center"
                          HorizontalOptions="Center"/>
        <Label x:Name="EmptyLabel" 
               Grid.Row="1"
               Text="KhÃ´ng tÃ¬m tháº¥y sÃ¡ch mÆ°á»£n nÃ o" 
               FontSize="16"
               IsVisible="False"
               VerticalOptions="Center"
               HorizontalOptions="Center"/>
        <CollectionView x:Name="LoansCollection" 
                       Grid.Row="1"
                       ItemsSource="{Binding Loans}">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Margin="15,10" 
                           Padding="0"
                           BackgroundColor="White"
                           BorderColor="#FFE0E0E0"
                           CornerRadius="15"
                           HasShadow="True">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="0">
                            <Frame Grid.Column="0"
                                   Padding="0"
                                   BackgroundColor="Transparent"
                                   CornerRadius="15,0,0,15"
                                   HasShadow="False">
                                <Image Source="{Binding CoverImageUrl}"
                                       Aspect="AspectFill"
                                       WidthRequest="120"
                                       HeightRequest="180"
                                       BackgroundColor="LightGray"/>
                            </Frame>
                            <VerticalStackLayout Grid.Column="1" Spacing="8" Padding="15">
                                <Label Text="{Binding Title}" 
                                       FontSize="18" 
                                       FontAttributes="Bold" 
                                       LineBreakMode="WordWrap"
                                       MaxLines="2"
                                       TextColor="#FF212121"/>
                                <Label Text="{Binding Authors, Converter={StaticResource AuthorsConverter}, StringFormat='âœï¸ {0}'}" 
                                       FontSize="14" 
                                       LineBreakMode="WordWrap"
                                       MaxLines="2"
                                       TextColor="#FF757575"/>
                                <Label Text="{Binding ManagementCode, StringFormat='ðŸ·ï¸ MÃ£: {0}'}" 
                                       FontSize="12"
                                       TextColor="#FF9E9E9E"/>
                                <BoxView HeightRequest="1" 
                                         Color="#FFE0E0E0" 
                                         Margin="0,8"/>
                                <Grid ColumnDefinitions="*,*" ColumnSpacing="10" Margin="0,5">
                                    <VerticalStackLayout Grid.Column="0" Spacing="3">
                                        <Label Text="{Binding BorrowDate, StringFormat='ðŸ“… MÆ°á»£n: {0:yyyy-MM-dd}'}" 
                                               FontSize="12"
                                               TextColor="#FF757575"/>
                                        <Label Text="{Binding DueDate, StringFormat='â° Háº¡n: {0:yyyy-MM-dd}'}" 
                                               FontSize="12"
                                               FontAttributes="Bold"
                                               TextColor="#FFFF5722"/>
                                    </VerticalStackLayout>
                                    <VerticalStackLayout Grid.Column="1" Spacing="3">
                                        <Label Text="{Binding Status, StringFormat='ðŸ“Š {0}'}" 
                                               FontSize="13" 
                                               FontAttributes="Bold"
                                               TextColor="#FF2196F3"
                                               HorizontalOptions="End"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </VerticalStackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>

