<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="book.Pages.Admin.BorrowRequestsPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="YÃªu cáº§u MÆ°á»£n"
             BackgroundColor="#F3F4F6">

    <Grid>
        <BoxView IsHitTestVisible="False">
            <BoxView.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#F3F4F6" Offset="0.0" />
                    <GradientStop Color="#EDE9FE" Offset="1.0" />
                </LinearGradientBrush>
            </BoxView.Background>
        </BoxView>

        <Grid RowDefinitions="Auto,Auto,*">

            <VerticalStackLayout Grid.Row="0" Spacing="15" Padding="20,10,20,10">
                <Grid ColumnDefinitions="Auto, *">
                    <Border Grid.Column="0" 
                            StrokeShape="RoundRectangle 12" 
                            BackgroundColor="White" 
                            StrokeThickness="0"
                            HeightRequest="40" 
                            WidthRequest="40"
                            VerticalOptions="Center">
                        <Border.Shadow>
                            <Shadow Brush="#000000" Opacity="0.05" Offset="0,4" Radius="10" />
                        </Border.Shadow>
                        <Label Text="âžœ" 
       Rotation="180"
       
       FontSize="20" 
       TextColor="#1F2937" 
       HorizontalOptions="Center" 
       VerticalOptions="Center"/>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnBackClicked"/>
                        </Border.GestureRecognizers>
                    </Border>

                    <VerticalStackLayout Grid.Column="1" Spacing="0" VerticalOptions="Center" Margin="15,0,0,0">
                        <Label Text="Quáº£n trá»‹ viÃªn" FontSize="12" TextColor="#6B7280" />
                        <Label Text="Duyá»‡t YÃªu Cáº§u MÆ°á»£n" FontSize="20" FontAttributes="Bold" TextColor="#1F2937" />
                    </VerticalStackLayout>
                </Grid>
            </VerticalStackLayout>

            <ScrollView Grid.Row="1" Orientation="Horizontal" HorizontalScrollBarVisibility="Never" Padding="20,0,20,15">
                <HorizontalStackLayout Spacing="10">
                    <Button x:Name="FilterAllButton" 
                            Text="ðŸ“‘ Táº¥t cáº£" 
                            Clicked="OnFilterAllClicked"
                            BackgroundColor="#6C63FF"
                            TextColor="White"
                            CornerRadius="20"
                            FontAttributes="Bold"
                            HeightRequest="40"
                            Padding="20,0">
                        <Button.Shadow>
                            <Shadow Brush="#6C63FF" Opacity="0.3" Offset="0,4" Radius="10"/>
                        </Button.Shadow>
                    </Button>

                    <Button x:Name="FilterPendingButton" 
                            Text="â³ Chá» duyá»‡t" 
                            Clicked="OnFilterPendingClicked"
                            BackgroundColor="#E0E7FF"
                            TextColor="#4338CA"
                            CornerRadius="20"
                            FontAttributes="Bold"
                            HeightRequest="40"
                            Padding="20,0"
                            BorderWidth="0"/>

                    <Button x:Name="FilterApprovedButton" 
                            Text="âœ… ÄÃ£ duyá»‡t" 
                            Clicked="OnFilterApprovedClicked"
                            BackgroundColor="#DCFCE7"
                            TextColor="#166534"
                            CornerRadius="20"
                            FontAttributes="Bold"
                            HeightRequest="40"
                            Padding="20,0"
                            BorderWidth="0"/>

                    <Button x:Name="FilterRejectedButton" 
                            Text="âŒ ÄÃ£ tá»« chá»‘i" 
                            Clicked="OnFilterRejectedClicked"
                            BackgroundColor="#FEE2E2"
                            TextColor="#991B1B"
                            CornerRadius="20"
                            FontAttributes="Bold"
                            HeightRequest="40"
                            Padding="20,0"
                            BorderWidth="0"/>

                    <Button Text="ðŸ”„" 
                            Clicked="OnRefreshClicked"
                            BackgroundColor="White"
                            TextColor="#6C63FF"
                            CornerRadius="20"
                            FontAttributes="Bold"
                            HeightRequest="40"
                            WidthRequest="40"
                            Padding="0">
                        <Button.Shadow>
                            <Shadow Brush="#000000" Opacity="0.1" Offset="0,2" Radius="5"/>
                        </Button.Shadow>
                    </Button>
                </HorizontalStackLayout>
            </ScrollView>

            <CollectionView x:Name="RequestsCollection" 
                            Grid.Row="2"
                            ItemsSource="{Binding Requests}">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="15"/>
                </CollectionView.ItemsLayout>
                <CollectionView.Header>
                    <BoxView HeightRequest="5" Color="Transparent"/>
                </CollectionView.Header>
                <CollectionView.Footer>
                    <BoxView HeightRequest="20" Color="Transparent"/>
                </CollectionView.Footer>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="20,0" 
                                Padding="20"
                                BackgroundColor="White"
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 15">
                            <Border.Shadow>
                                <Shadow Brush="#000000" Opacity="0.05" Offset="0,4" Radius="10"/>
                            </Border.Shadow>

                            <VerticalStackLayout Spacing="12">
                                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                    <VerticalStackLayout Grid.Column="0" Spacing="2">
                                        <Label Text="{Binding ReaderName}" 
                                               FontSize="16" 
                                               FontAttributes="Bold"
                                               TextColor="#1F2937"/>
                                        <Label Text="{Binding ReaderEmail}" 
                                               FontSize="12"
                                               TextColor="#6B7280"/>
                                    </VerticalStackLayout>

                                    <Border Grid.Column="1"
                                            Padding="10,5"
                                            BackgroundColor="#F3F4F6"
                                            StrokeThickness="0"
                                            StrokeShape="RoundRectangle 10"
                                            VerticalOptions="Start">
                                        <Label Text="{Binding Status}" 
                                               FontSize="12" 
                                               FontAttributes="Bold"
                                               TextColor="{Binding StatusColor}"/>
                                    </Border>
                                </Grid>

                                <BoxView HeightRequest="1" Color="#F3F4F6"/>

                                <VerticalStackLayout Spacing="5">
                                    <Label Text="{Binding BookTitles}" 
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           LineBreakMode="TailTruncation"
                                           MaxLines="2"
                                           TextColor="#4B5563"/>

                                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                                        <Label Grid.Column="0" Text="{Binding DueDate, StringFormat='â³ Háº¡n: {0:dd/MM/yyyy}'}" FontSize="12" TextColor="#6B7280"/>
                                        <Label Grid.Column="1" Text="{Binding CreatedAt, StringFormat='ðŸ“… Táº¡o: {0:dd/MM}'}" FontSize="12" TextColor="#9CA3AF" HorizontalOptions="End"/>
                                    </Grid>

                                    <Label Text="{Binding RejectionReason, StringFormat='âš ï¸ LÃ½ do: {0}'}" 
                                           FontSize="12"
                                           TextColor="#EF4444"
                                           IsVisible="{Binding HasRejectionReason}"/>
                                </VerticalStackLayout>

                                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10" Margin="0,5,0,0">
                                    <Button Grid.Column="0"
                                            Text="ðŸ‘ï¸" 
                                            Clicked="OnViewDetailsClicked"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="#EFF6FF"
                                            TextColor="#3B82F6"
                                            CornerRadius="10"
                                            HeightRequest="40"
                                            Padding="0"/>

                                    <Button Grid.Column="1"
                                            Text="âœ… Duyá»‡t" 
                                            Clicked="OnApproveClicked"
                                            CommandParameter="{Binding .}"
                                            IsEnabled="{Binding CanApprove}"
                                            BackgroundColor="#10B981"
                                            TextColor="White"
                                            CornerRadius="10"
                                            FontAttributes="Bold"
                                            HeightRequest="40"
                                            Padding="0">
                                        <Button.Shadow>
                                            <Shadow Brush="#10B981" Opacity="0.3" Offset="0,4" Radius="8"/>
                                        </Button.Shadow>
                                    </Button>

                                    <Button Grid.Column="2"
                                            Text="âŒ Tá»« chá»‘i" 
                                            Clicked="OnRejectClicked"
                                            CommandParameter="{Binding .}"
                                            IsEnabled="{Binding CanReject}"
                                            BackgroundColor="#EF4444"
                                            TextColor="White"
                                            CornerRadius="10"
                                            FontAttributes="Bold"
                                            HeightRequest="40"
                                            Padding="0">
                                        <Button.Shadow>
                                            <Shadow Brush="#EF4444" Opacity="0.3" Offset="0,4" Radius="8"/>
                                        </Button.Shadow>
                                    </Button>
                                </Grid>
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <ActivityIndicator x:Name="LoadingIndicator" 
                               Grid.Row="2"
                               IsRunning="False" 
                               IsVisible="False" 
                               Color="#6C63FF"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"/>

            <Label x:Name="EmptyLabel" 
                   Grid.Row="2"
                   Text="ðŸ“­ KhÃ´ng tÃ¬m tháº¥y yÃªu cáº§u nÃ o" 
                   FontSize="16"
                   TextColor="#9CA3AF"
                   IsVisible="False"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"/>
        </Grid>
    </Grid>
</ContentPage>