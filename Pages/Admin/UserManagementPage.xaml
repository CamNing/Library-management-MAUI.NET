<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="book.Pages.Admin.UserManagementPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:book.Converters"
             Title="Quáº£n lÃ½ NgÆ°á»i dÃ¹ng"
             BackgroundColor="#F3F4F6"
             Shell.NavBarIsVisible="False">

    <Grid>
        <BoxView IsHitTestVisible="False" VerticalOptions="Start" HeightRequest="300">
            <BoxView.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#F3F4F6" Offset="0.0" />
                    <GradientStop Color="#EDE9FE" Offset="1.0" />
                </LinearGradientBrush>
            </BoxView.Background>
        </BoxView>

        <Grid RowDefinitions="Auto, *">

            <Grid Grid.Row="0" ColumnDefinitions="Auto, *, Auto" Padding="20,15,20,15">

                <Border Grid.Column="0" 
                        StrokeShape="RoundRectangle 12" 
                        BackgroundColor="White" 
                        StrokeThickness="0" 
                        HeightRequest="40" 
                        WidthRequest="40">
                    <Border.Shadow>
                        <Shadow Brush="#000000" Opacity="0.05" Offset="0,4" Radius="10"/>
                    </Border.Shadow>
                    <Label Text="âžœ" Rotation="180" FontSize="20" TextColor="#1F2937" 
                           HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnBackClicked"/>
                    </Border.GestureRecognizers>
                </Border>

                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="0">
                    <Label Text="Quáº£n lÃ½ NgÆ°á»i dÃ¹ng" 
                           FontSize="20" 
                           FontAttributes="Bold" 
                           TextColor="#1F2937" 
                           HorizontalOptions="Center"/>
                    <Label Text="Danh sÃ¡ch tÃ i khoáº£n" 
                           FontSize="12" 
                           TextColor="#6B7280" 
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>

                <Border Grid.Column="2" 
                        StrokeShape="RoundRectangle 12" 
                        BackgroundColor="#6C63FF" 
                        StrokeThickness="0" 
                        HeightRequest="40" 
                        WidthRequest="40">
                    <Border.Shadow>
                        <Shadow Brush="#6C63FF" Opacity="0.3" Offset="0,4" Radius="10"/>
                    </Border.Shadow>
                    <Label Text="+" FontSize="26" TextColor="White" 
                           HorizontalOptions="Center" VerticalOptions="Center" Margin="0,-2,0,0"/>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnAddUserClicked"/>
                    </Border.GestureRecognizers>
                </Border>
            </Grid>

            <CollectionView x:Name="UsersCollection" 
                            Grid.Row="1"
                            ItemsSource="{Binding Users}">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="15"/>
                </CollectionView.ItemsLayout>

                <CollectionView.Header>
                    <BoxView HeightRequest="5" Color="Transparent"/>
                </CollectionView.Header>
                <CollectionView.Footer>
                    <BoxView HeightRequest="20" Color="Transparent"/>
                </CollectionView.Footer>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="20,0">
                            <Border StrokeShape="RoundRectangle 20"
                                    BackgroundColor="White"
                                    StrokeThickness="0"
                                    Padding="15">
                                <Border.Shadow>
                                    <Shadow Brush="#000000" Opacity="0.05" Offset="0,4" Radius="10"/>
                                </Border.Shadow>

                                <Grid RowDefinitions="Auto, Auto" RowSpacing="15">

                                    <Grid Grid.Row="0" ColumnDefinitions="50, *, Auto">

                                        <Border Grid.Column="0" 
                                                HeightRequest="50" WidthRequest="50" 
                                                StrokeShape="RoundRectangle 25"
                                                BackgroundColor="#F3F4F6"
                                                StrokeThickness="0"
                                                VerticalOptions="Start">
                                            <Label Text="ðŸ‘¤" FontSize="24" HorizontalOptions="Center" VerticalOptions="Center"/>
                                        </Border>

                                        <VerticalStackLayout Grid.Column="1" Margin="10,0,0,0" VerticalOptions="Center" Spacing="2">
                                            <Label Text="{Binding Username}" 
                                                   FontSize="16" 
                                                   FontAttributes="Bold" 
                                                   TextColor="#1F2937"/>
                                            <Label Text="{Binding Email}" 
                                                   FontSize="12" 
                                                   TextColor="#6B7280"/>

                                            <Label Text="{Binding ReaderCardCode, StringFormat='ðŸ’³ {0}'}" 
                                                   FontSize="11" 
                                                   TextColor="#6C63FF"
                                                   IsVisible="{Binding ReaderCardCode, Converter={StaticResource StringToBoolConverter}}"
                                                   Margin="0,2,0,0"/>
                                        </VerticalStackLayout>

                                        <VerticalStackLayout Grid.Column="2" Spacing="5" HorizontalOptions="End">
                                            <Border BackgroundColor="#EEF2FF" StrokeThickness="0" StrokeShape="RoundRectangle 6" Padding="8,2" HorizontalOptions="End">
                                                <Label Text="{Binding Role}" FontSize="10" TextColor="#6C63FF" FontAttributes="Bold" TextTransform="Uppercase"/>
                                            </Border>

                                            <Border StrokeThickness="0" StrokeShape="RoundRectangle 6" Padding="8,2" HorizontalOptions="End">
                                                <Border.Triggers>
                                                    <DataTrigger TargetType="Border" Binding="{Binding IsActive}" Value="True">
                                                        <Setter Property="BackgroundColor" Value="#ECFDF5"/>
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Border" Binding="{Binding IsActive}" Value="False">
                                                        <Setter Property="BackgroundColor" Value="#FEF2F2"/>
                                                    </DataTrigger>
                                                </Border.Triggers>
                                                <Label FontSize="10" FontAttributes="Bold">
                                                    <Label.Triggers>
                                                        <DataTrigger TargetType="Label" Binding="{Binding IsActive}" Value="True">
                                                            <Setter Property="Text" Value="ACTIVE"/>
                                                            <Setter Property="TextColor" Value="#10B981"/>
                                                        </DataTrigger>
                                                        <DataTrigger TargetType="Label" Binding="{Binding IsActive}" Value="False">
                                                            <Setter Property="Text" Value="LOCKED"/>
                                                            <Setter Property="TextColor" Value="#EF4444"/>
                                                        </DataTrigger>
                                                    </Label.Triggers>
                                                </Label>
                                            </Border>
                                        </VerticalStackLayout>
                                    </Grid>

                                    <BoxView HeightRequest="1" Color="#F3F4F6" Grid.Row="0" VerticalOptions="End" Margin="0,55,0,-10"/>

                                    <Grid Grid.Row="1" ColumnDefinitions="*, *" ColumnSpacing="10">

                                        <Button Grid.Column="0" 
                                                Text="ðŸ”‘ Äáº·t láº¡i Pass" 
                                                Clicked="OnResetPasswordClicked"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="#FFF7ED" 
                                                TextColor="#EA580C"
                                                FontSize="12"
                                                FontAttributes="Bold"
                                                HeightRequest="36"
                                                CornerRadius="8"
                                                Padding="0"/>

                                        <Button Grid.Column="1" 
                                                Clicked="OnToggleActiveClicked"
                                                CommandParameter="{Binding .}"
                                                FontSize="12"
                                                FontAttributes="Bold"
                                                HeightRequest="36"
                                                CornerRadius="8"
                                                Padding="0">
                                            <Button.Triggers>
                                                <DataTrigger TargetType="Button" Binding="{Binding IsActive}" Value="True">
                                                    <Setter Property="Text" Value="ðŸ”’ KhÃ³a"/>
                                                    <Setter Property="BackgroundColor" Value="#FEF2F2"/>
                                                    <Setter Property="TextColor" Value="#DC2626"/>
                                                </DataTrigger>
                                                <DataTrigger TargetType="Button" Binding="{Binding IsActive}" Value="False">
                                                    <Setter Property="Text" Value="ðŸ”“ Má»Ÿ khÃ³a"/>
                                                    <Setter Property="BackgroundColor" Value="#ECFDF5"/>
                                                    <Setter Property="TextColor" Value="#059669"/>
                                                </DataTrigger>
                                            </Button.Triggers>
                                        </Button>
                                    </Grid>
                                </Grid>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </Grid>
</ContentPage>